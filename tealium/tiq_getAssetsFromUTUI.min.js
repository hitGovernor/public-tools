let tiqHelper={getId:function(type,asset){try{return asset._id||asset.id||""}catch(err){return""}},getName:function(type,asset){try{let retval="datalayer"===type?asset.name:asset.title;return retval=retval.replace(/[,\t]/g," "),retval}catch(err){return""}},getType:function(type,asset){try{let retval="";return"datalayer"===type?retval=asset.type:"tag"===type?(retval=asset.tag_name,retval+=asset.config_tagtype?" - "+asset.config_tagtype:""):"extension"===type&&(retval=asset.extType),retval}catch(err){return""}},getStatus:function(type,asset){try{return asset.status||""}catch(err){return""}},getPublishTargets:function(type,asset){try{let retval={last_modified:asset.publish_revisions.last_modified};return Object.assign(retval,asset.publish_revisions.svr_save_timestamps),retval}catch(err){return{}}},getLastPublishDetail:function(pub_date){try{let retval={},obj=utui.data.publish_history[pub_date][pub_date];return retval.notes=obj.notes,retval.operator=obj.operator,retval}catch(err){return{}}},getLastModified:function(type,asset){try{return asset.publish_revisions.last_modified}catch(err){return""}},addToDataList:function(ary,key){return ary.includes(key)||ary.push(key),ary},getMappedVars:function(type,asset){let output=[];if("tag"===type)for(let mapped in asset.map)output.push(asset.map[mapped].type+"."+asset.map[mapped].key);else if("extension"===type)for(let key in asset)/_source$/.test(key)&&this.addToDataList(output,asset[key]),"Set Data Values"===asset.extType?/_set$/.test(key)&&this.addToDataList(output,asset[key]):"Lookup Table"===asset.extType?"var"!==key&&"varlookup"!==key||this.addToDataList(output,asset[key]):"Join Data Values"===asset.extType?(/_set$/.test(key)||"var"===key)&&this.addToDataList(output,asset[key]):"Persist Data Value"===asset.extType&&("var"!==key&&"settovar"!==key||this.addToDataList(output,asset[key]));else if("loadrule"===type)for(let key in asset)if("object"==typeof asset[key])for(let subkey in asset[key])/^input_/.test(subkey)&&this.addToDataList(output,asset[key][subkey]);return output.join("|")},getLoadRuleTagCount:function(type,asset){return"loadrule"===type?utui.loadrules.getTagsScopedCount(asset)||{}:{active:"",inactive:"",total:""}},getLoadRulesForTags:function(type,asset){return"tag"===type?asset.loadrule.replaceAll(",","|"):""},getExtensionScope:function(type,asset){return"extension"===type?asset.scope.replaceAll(",","|"):""},getLabels:function(type,asset){try{let retval=[];return asset.labels&&asset.labels.split(",").forEach((function(item){retval.push(utui.data.labels[item].name)})),asset.imported&&retval.push(asset.imported),retval.join("|")}catch(err){return""}},getParentLibrary:function(asset){try{return asset.settings.profileid}catch(err){return""}},getDoNotSellStatus:function(type,asset){try{if("tag"===type){let retval="";for(key in utui.data.privacy_management.doNotSell.categories){let tmp;if(utui.data.privacy_management.doNotSell.categories[key].tagid.forEach((function(item){if(item.id===asset.id)return retval=item.doNotSell,!1})),""!==retval)break}return retval}}catch(err){}},convertToCSV:function(assets){let allBody=[],headers=[];headers=Object.keys(assets[0]).join(",")+"\n";for(let item in assets){let tmp=assets[item],tmpArray=[];for(let key in tmp)tmpArray.push(tmp[key]);allBody.push(tmpArray.join(","))}return headers+allBody.join("\n")},getAllAssets:function(){let retval;return this.getAssetsByType("tag","extension","loadrule","datalayer")},getAssetsByType:function(){let ACCOUNT=document.getElementById("profile_legend_account").innerText,PROFILE=document.getElementById("profile_legend_profile").innerText,tagsToGet=Array.from(arguments),retval=[],assetSources={tag:utui.data.manage,extension:utui.data.customizations,loadrule:utui.data.loadrules,datalayer:utui.data.define};return tagsToGet.forEach((function(item){let assets=assetSources[item];for(let key in assets){let tmp={},loadRuleTagCounts=tiqHelper.getLoadRuleTagCount(item,assets[key]),publishTargetsAndDates=tiqHelper.getPublishTargets(item,assets[key]),lastProdPublishDetails=tiqHelper.getLastPublishDetail(publishTargetsAndDates.prod);tmp.account=ACCOUNT,tmp.profile=PROFILE,tmp.parentLibrary=tiqHelper.getParentLibrary(assets[key]),tmp.assetType=item,tmp.id=tiqHelper.getId(item,assets[key]),tmp.name=tiqHelper.getName(item,assets[key]),tmp.lastModified=publishTargetsAndDates.last_modified||"unpublished",tmp.lastDevPubDate=publishTargetsAndDates.dev||"unpublished",tmp.lastQAPubDate=publishTargetsAndDates.qa||"unpublished",tmp.lastProdPubDate=publishTargetsAndDates.prod||"unpublished",tmp.lastProdPubUser=lastProdPublishDetails.operator||"",tmp.lastProdPubNotes=lastProdPublishDetails.notes||"",tmp.type=tiqHelper.getType(item,assets[key]),tmp.status=tiqHelper.getStatus(item,assets[key]),tmp.labels=tiqHelper.getLabels(item,assets[key]),tmp.mappedVars=tiqHelper.getMappedVars(item,assets[key]),tmp.loadRuleTagsActive=loadRuleTagCounts.active,tmp.loadRuleTagsInactive=loadRuleTagCounts.inactive,tmp.tagLoadRules=tiqHelper.getLoadRulesForTags(item,assets[key]),tmp.extensionScope=tiqHelper.getExtensionScope(item,assets[key]),tmp.doNotSell=tiqHelper.getDoNotSellStatus(item,assets[key]),retval.push(tmp)}})),retval}},myTiQAssets=tiqHelper.getAllAssets(),userInput=prompt("Sepcify your preferred format:\n\n* table: Displays assets using console.table()\n* csv: Displays assets as a comma-delimited string\n\nNote: Make sure you are in TiQ, with the Data Layer tab selected.","table","csv");/^csv$/i.test(userInput)?console.log(tiqHelper.convertToCSV(myTiQAssets)):/^table$/i.test(userInput)?console.table(myTiQAssets):console.log('tiqHelper: Invalid input. Please specify "csv" or "table".');